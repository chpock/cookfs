<!DOCTYPE html><html><head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>cookfs::pages - vfs::cookfs::pages</title>
<style type="text/css"><!--
    HTML {
	background: 	#FFFFFF;
	color: 		black;
    }
    BODY {
	background: 	#FFFFFF;
	color:	 	black;
    }
    DIV.doctools {
	margin-left:	10%;
	margin-right:	10%;
    }
    DIV.doctools H1,DIV.doctools H2 {
	margin-left:	-5%;
    }
    H1, H2, H3, H4 {
	margin-top: 	1em;
	font-family:	sans-serif;
	font-size:	large;
	color:		#005A9C;
	background: 	transparent;
	text-align:		left;
    }
    H1.doctools_title {
	text-align: center;
    }
    UL,OL {
	margin-right: 0em;
	margin-top: 3pt;
	margin-bottom: 3pt;
    }
    UL LI {
	list-style: disc;
    }
    OL LI {
	list-style: decimal;
    }
    DT {
	padding-top: 	1ex;
    }
    UL.doctools_toc,UL.doctools_toc UL, UL.doctools_toc UL UL {
	font:		normal 12pt/14pt sans-serif;
	list-style:	none;
    }
    LI.doctools_section, LI.doctools_subsection {
	list-style: 	none;
	margin-left: 	0em;
	text-indent:	0em;
	padding: 	0em;
    }
    PRE {
	display: 	block;
	font-family:	monospace;
	white-space:	pre;
	margin:		0%;
	padding-top:	0.5ex;
	padding-bottom:	0.5ex;
	padding-left:	1ex;
	padding-right:	1ex;
	width:		100%;
    }
    PRE.doctools_example {
	color: 		black;
	background: 	#f5dcb3;
	border:		1px solid black;
    }
    UL.doctools_requirements LI, UL.doctools_syntax LI {
	list-style: 	none;
	margin-left: 	0em;
	text-indent:	0em;
	padding:	0em;
    }
    DIV.doctools_synopsis {
	color: 		black;
	background: 	#80ffff;
	border:		1px solid black;
	font-family:	serif;
	margin-top: 	1em;
	margin-bottom: 	1em;
    }
    UL.doctools_syntax {
	margin-top: 	1em;
	border-top:	1px solid black;
    }
    UL.doctools_requirements {
	margin-bottom: 	1em;
	border-bottom:	1px solid black;
    }
--></style>
</head>
<!-- Generated from file 'cookfs_pages.man' by tcllib/doctools with format 'html'
   -->
<!-- Copyright &amp;copy; 2010-2011 Wojciech Kocjan &amp;lt;wojciech@kocjan.org&amp;gt;   -- Copyright &amp;copy; 2024 Konstantin Kushnir &amp;lt;chpock@gmail.com&amp;gt;
   -->
<!-- cookfs::pages.n
   -->
<body><div class="doctools">
<h1 class="doctools_title">cookfs::pages(n) 1.5.0 cookfs_pages &quot;vfs::cookfs::pages&quot;</h1>
<div id="name" class="doctools_section"><h2><a name="name">Name</a></h2>
<p>cookfs::pages - vfs::cookfs::pages</p>
</div>
<div id="toc" class="doctools_section"><h2><a name="toc">Table Of Contents</a></h2>
<ul class="doctools_toc">
<li class="doctools_section"><a href="#toc">Table Of Contents</a></li>
<li class="doctools_section"><a href="#synopsis">Synopsis</a></li>
<li class="doctools_section"><a href="#section1">Description</a></li>
<li class="doctools_section"><a href="#section2">COMMANDS</a></li>
<li class="doctools_section"><a href="#section3">PAGES OPTIONS</a></li>
<li class="doctools_section"><a href="#see-also">See Also</a></li>
<li class="doctools_section"><a href="#keywords">Keywords</a></li>
<li class="doctools_section"><a href="#copyright">Copyright</a></li>
</ul>
</div>
<div id="synopsis" class="doctools_section"><h2><a name="synopsis">Synopsis</a></h2>
<div class="doctools_synopsis">
<ul class="doctools_requirements">
<li>package require <b class="pkgname">Tcl 8.5</b></li>
<li>package require <b class="pkgname">vfs::cookfs <span class="opt">?1.5.0?</span></b></li>
</ul>
<ul class="doctools_syntax">
<li><a href="#1"><b class="cmd">::cookfs::pages</b> <span class="opt">?<i class="arg">options</i>?</span> <i class="arg">archive</i></a></li>
<li><a href="#2"><i class="arg">pagesHandle</i> <b class="method">aside</b> <i class="arg">filename</i></a></li>
<li><a href="#3"><i class="arg">pagesHandle</i> <b class="method">add</b> <i class="arg">contents</i></a></li>
<li><a href="#4"><i class="arg">pagesHandle</i> <b class="method">get</b> <span class="opt">?<i class="arg">-weight weight</i>?</span> <i class="arg">pageIdx</i></a></li>
<li><a href="#5"><i class="arg">pagesHandle</i> <b class="method">length</b></a></li>
<li><a href="#6"><i class="arg">pagesHandle</i> <b class="method">index</b> <span class="opt">?<i class="arg">newIndex</i>?</span></a></li>
<li><a href="#7"><i class="arg">pagesHandle</i> <b class="method">dataoffset</b></a></li>
<li><a href="#8"><i class="arg">pagesHandle</i> <b class="method">delete</b></a></li>
<li><a href="#9"><i class="arg">pagesHandle</i> <b class="method">gethead</b></a></li>
<li><a href="#10"><i class="arg">pagesHandle</i> <b class="method">getheadmd5</b></a></li>
<li><a href="#11"><i class="arg">pagesHandle</i> <b class="method">gettail</b></a></li>
<li><a href="#12"><i class="arg">pagesHandle</i> <b class="method">gettailmd5</b></a></li>
<li><a href="#13"><i class="arg">pagesHandle</i> <b class="method">cachesize</b> <span class="opt">?<i class="arg">numPages</i>?</span></a></li>
<li><a href="#14"><i class="arg">pagesHandle</i> <b class="method">getcache</b> <span class="opt">?<i class="arg">pageIdx</i>?</span></a></li>
<li><a href="#15"><i class="arg">pagesHandle</i> <b class="method">ticktock</b> <span class="opt">?<i class="arg">maxAge</i>?</span></a></li>
<li><a href="#16"><i class="arg">pagesHandle</i> <b class="method">filesize</b></a></li>
<li><a href="#17"><i class="arg">pagesHandle</i> <b class="method">hash</b></a></li>
<li><a href="#18"><i class="arg">pagesHandle</i> <b class="method">close</b></a></li>
</ul>
</div>
</div>
<div id="section1" class="doctools_section"><h2><a name="section1">Description</a></h2>
<p>Cookfs pages provide a low level mechanism for reading and writing to cookfs pages.</p>
<p>This mechanism should only be used by advanced users and is only documented for reference.</p>
</div>
<div id="section2" class="doctools_section"><h2><a name="section2">COMMANDS</a></h2>
<dl class="doctools_definitions">
<dt><a name="1"><b class="cmd">::cookfs::pages</b> <span class="opt">?<i class="arg">options</i>?</span> <i class="arg">archive</i></a></dt>
<dd><p>Creates a new pages object that can be used to read and write pages.</p>
<p>The command returns a pages command that can be used to perform actions on pages.</p>
<p>For definition of available options, see <span class="sectref"><a href="#section3">PAGES OPTIONS</a></span>.</p></dd>
<dt><a name="2"><i class="arg">pagesHandle</i> <b class="method">aside</b> <i class="arg">filename</i></a></dt>
<dd><p>Uses a separate file for storing changes to an archive. This can be used to keep changes for a read-only archive in a separate file.
See <b class="sectref">cookfs</b> for more details on aside files and how they can be used.</p></dd>
<dt><a name="3"><i class="arg">pagesHandle</i> <b class="method">add</b> <i class="arg">contents</i></a></dt>
<dd><p>Add a new page to archive. Index of new page is returned. Index will be between 0 and <b class="method">length</b>-1.</p>
<p>When adding a page that already exists, index to already existing page is returned.
Otherwise a new page is added at the end and its index is returned.</p></dd>
<dt><a name="4"><i class="arg">pagesHandle</i> <b class="method">get</b> <span class="opt">?<i class="arg">-weight weight</i>?</span> <i class="arg">pageIdx</i></a></dt>
<dd><p>Gets a page in an archive. This can be between 0 and <b class="method">length</b>-1.</p>
<p>If <i class="arg">-weight weight</i> is specified, the appropriate weight will be set for
the cache entry for the returned page. If it is not specified, the weight of
the cache entry for the returned page will be set to 0.</p>
<p>See <b class="sectref">cookfs</b> for more details on caching in cookfs.</p></dd>
<dt><a name="5"><i class="arg">pagesHandle</i> <b class="method">length</b></a></dt>
<dd><p>Returns number of pages in an archive.</p></dd>
<dt><a name="6"><i class="arg">pagesHandle</i> <b class="method">index</b> <span class="opt">?<i class="arg">newIndex</i>?</span></a></dt>
<dd><p>Get or set index data. Index is a binary data that is stored in an archive and can be changed at any time.
This is used to store exported version of <b class="sectref">cookfs_fsindex</b>.</p></dd>
<dt><a name="7"><i class="arg">pagesHandle</i> <b class="method">dataoffset</b></a></dt>
<dd><p>Returns offset to beginning of cookfs archive in the file.</p></dd>
<dt><a name="8"><i class="arg">pagesHandle</i> <b class="method">delete</b></a></dt>
<dd><p>Saves all changes and deletes a cookfs pages object.</p></dd>
<dt><a name="9"><i class="arg">pagesHandle</i> <b class="method">gethead</b></a></dt>
<dd></dd>
<dt><a name="10"><i class="arg">pagesHandle</i> <b class="method">getheadmd5</b></a></dt>
<dd></dd>
<dt><a name="11"><i class="arg">pagesHandle</i> <b class="method">gettail</b></a></dt>
<dd></dd>
<dt><a name="12"><i class="arg">pagesHandle</i> <b class="method">gettailmd5</b></a></dt>
<dd><p>Gets part of file as binary data or MD5 checksum of it.
Head is the part of the file prior to cookfs archive.
Tail is the entire cookfs archive.</p>
<p>These commands can be used as helper procedures to read or compare currently open/mounted binaries.</p></dd>
<dt><a name="13"><i class="arg">pagesHandle</i> <b class="method">cachesize</b> <span class="opt">?<i class="arg">numPages</i>?</span></a></dt>
<dd><p>Sets or gets maximum number of pages to store in cache.
If <i class="arg">numPages</i> is specified, size is modified. If more than <i class="arg">numPages</i> pages are currently buffered, they are removed from cache.
If 0, no cache is used. Otherwise, up to <i class="arg">numPages</i> are kept in memory</p></dd>
<dt><a name="14"><i class="arg">pagesHandle</i> <b class="method">getcache</b> <span class="opt">?<i class="arg">pageIdx</i>?</span></a></dt>
<dd><p>If <i class="arg">pageIdx</i> is specified, returns a boolean value corresponding to whether
the internal cache contains data for the specified page.</p>
<p>If <i class="arg">pageIdx</i> is not specified, the content of the cache is returned.</p>
<p>The contents of the cache are a list of entries. Each element in the list is
a Tcl dict with keys: index, weight and age.</p>
<p>This method is mainly used in tests.</p></dd>
<dt><a name="15"><i class="arg">pagesHandle</i> <b class="method">ticktock</b> <span class="opt">?<i class="arg">maxAge</i>?</span></a></dt>
<dd><p>If <i class="arg">maxAge</i> is specified, sets the maximum age for cache entries.</p>
<p>It <i class="arg">maxAge</i> is not specified, the age of all cache entries is incremented by 1.
The current age for each record is also checked against the previously set maxAge.
If the current age of an entry is greater than or equal to the maxAge value
set previously, its weight will be reset to 0.</p>
<p>See <b class="sectref">cookfs</b> for more details on caching in cookfs.</p></dd>
<dt><a name="16"><i class="arg">pagesHandle</i> <b class="method">filesize</b></a></dt>
<dd><p>Returns size of file up to last stored page.
The size only includes page sizes and does not include overhead for index and additional information used by cookfs.</p></dd>
<dt><a name="17"><i class="arg">pagesHandle</i> <b class="method">hash</b></a></dt>
<dd><p>Hash function to use for comparing if pages are equal. This is mainly used as pre-check and entire page is still checked for.
Defaults to <b class="const">md5</b>, can also be <b class="const">crc32</b>. Mainly for internal/testing at this moment. Do not use.</p></dd>
<dt><a name="18"><i class="arg">pagesHandle</i> <b class="method">close</b></a></dt>
<dd><p>Closes pages object and return offset to end of cookfs archive.
This is almost an equivalent of calling <b class="method">delete</b>.</p>
<p>This is meant for internal development and should not be used outside cookfs.</p></dd>
</dl>
</div>
<div id="section3" class="doctools_section"><h2><a name="section3">PAGES OPTIONS</a></h2>
<p>The following options can be specified when creating a cookfs pages object:</p>
<dl class="doctools_definitions">
<dt><b class="option">-readwrite</b></dt>
<dd><p>Open as read-write, which is the default. If file exists and is valid cookfs pages format archive, it is used.
Otherwise new cookfs pages archive is created at end of file.</p></dd>
<dt><b class="option">-readonly</b></dt>
<dd><p>Open as read-only. File must exist and be in valid cookfs pages format archive, otherwise operation will fail.</p></dd>
<dt><b class="option">-cachesize</b> <i class="arg">numPages</i></dt>
<dd><p>Maximum number of pages to store in cache.
If 0, no cache is used. Otherwise, up to <i class="arg">numPages</i> are kept in memory
for efficient access.</p></dd>
<dt><b class="option">-endoffset</b> <i class="arg">offset</i></dt>
<dd><p>Read archive starting at specified offset, instead of reading from end of file.</p>
<p>This feature is used when cookfs archive is not stored at end of file - for example if it is
used in tclkit and followed by mk4vfs archive.</p></dd>
<dt><b class="option">-compression</b> <i class="arg">none|zlib|bzip2|xz|custom</i></dt>
<dd><p>Compression to use for storing new files.</p>
<p>See <b class="sectref">cookfs</b> for more details on compression in cookfs.</p></dd>
<dt><b class="option">-compresscommand</b> <i class="arg">tcl command</i></dt>
<dd><p>For <i class="arg">custom</i> compression, specifies command to use for compressing pages.</p>
<p>See <b class="sectref">cookfs</b> for more details on compression in cookfs.</p></dd>
<dt><b class="option">-decompresscommand</b> <i class="arg">tcl command</i></dt>
<dd><p>For <i class="arg">custom</i> compression, specifies command to use for decompressing pages.</p>
<p>See <b class="sectref">cookfs</b> for more details on compression in cookfs.</p></dd>
</dl>
</div>
<div id="see-also" class="doctools_section"><h2><a name="see-also">See Also</a></h2>
<p>cookfs_fsindex, cookfs_pages</p>
</div>
<div id="keywords" class="doctools_section"><h2><a name="keywords">Keywords</a></h2>
<p>cookfs, vfs</p>
</div>
<div id="copyright" class="doctools_section"><h2><a name="copyright">Copyright</a></h2>
<p>Copyright &copy; 2010-2011 Wojciech Kocjan &lt;wojciech@kocjan.org&gt;<br>
Copyright &copy; 2024 Konstantin Kushnir &lt;chpock@gmail.com&gt;</p>
</div>
</div></body></html>
